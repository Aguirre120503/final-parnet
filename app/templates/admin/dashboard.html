{% extends "base.html" %}
{% block title %}Dashboard Admin | ParNet Ingenier√≠a{% endblock %}

{% block styles %}
<style>
    body {
        background: #0b65c2;
        color: white;
        font-family: Arial, Helvetica, sans-serif;
    }

    .dashboard-wrapper {
        max-width: 1100px;
        margin: 40px auto;
        background: #003d80;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    }

    h1 {
        color: #facc15;
        font-size: 2rem;
        margin-bottom: 10px;
    }

    .welcome {
        color: #dbeafe;
        margin-bottom: 25px;
    }

    .cards-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 15px;
        margin-bottom: 25px;
    }

    .card {
        background: #1e3a8a;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .card h2 {
        color: #facc15;
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1.1rem;
    }

    .raw-data {
        background: #0b3c68;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.85rem;
        white-space: pre-wrap;
    }

    @media (max-width: 900px) {
        .cards-row {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">

    <h1>Dashboard</h1>
    <p class="welcome">Bienvenido, <strong>{{ current_user.username }}</strong>.</p>

    <div class="cards-row">
        <div class="card">
            <h2>Servicios por tipo</h2>
            <canvas id="chartServicios"></canvas>
        </div>

        <div class="card">
            <h2>Productos por tipo</h2>
            <canvas id="chartProductos"></canvas>
        </div>
    </div>

    <div class="card">
        <h2>Datos crudos (para revisar r√°pido)</h2>
        <div class="raw-data">
Servicios: {{ data_servicios }}
Productos: {{ data_productos }}
        </div>
    </div>

</div>

<!-- Chart.js desde CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Convertimos los datos de Python a JSON para JS
  const serviciosData = {{ data_servicios | tojson }};
  const productosData = {{ data_productos | tojson }};

  // Gr√°fica de barras para servicios
  const ctxServicios = document.getElementById('chartServicios').getContext('2d');
  new Chart(ctxServicios, {
    type: 'bar',
    data: {
      labels: serviciosData.labels,
      datasets: [{
        label: 'Servicios',
        data: serviciosData.values,
        backgroundColor: 'rgba(250, 204, 21, 0.6)',   // amarillo transparente
        borderColor: 'rgba(250, 204, 21, 1)',
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1 }
        }
      }
    }
  });

  // Gr√°fica doughnut para productos
  const ctxProductos = document.getElementById('chartProductos').getContext('2d');
  new Chart(ctxProductos, {
    type: 'doughnut',
    data: {
      labels: productosData.labels,
      datasets: [{
        label: 'Productos',
        data: productosData.values,
        backgroundColor: [
          'rgba(250, 204, 21, 0.7)',
          'rgba(96, 165, 250, 0.7)',
          'rgba(52, 211, 153, 0.7)',
          'rgba(248, 113, 113, 0.7)',
          'rgba(196, 181, 253, 0.7)'
        ]
      }]
    },
    options: {
      plugins: {
        legend: {
          position: 'bottom',
          labels: { color: '#e5e7eb' }
        }
      }
    }
  });
</script>
<div style="margin-bottom: 20px;">
    <a href="{{ url_for('admin.productos_list') }}" 
       style="
         background: #004a8f;
         color: #facc15;
         padding: 10px 18px;
         font-weight: bold;
         border-radius: 8px;
         text-decoration: none;
         display: inline-block;
       ">
        Administrar productos
    </a>
</div>

<div style="margin-bottom: 20px;">
    <a href="{{ url_for('public.index') }}" 
       style="
         background:#004a8f;
         color:#facc15;
         padding:10px 18px;
         border-radius:8px;
         text-decoration:none;
         font-weight:bold;
         display:inline-block;
       ">
        ‚¨Ö Ir a P√°gina Principal
    </a>
</div>

<!-- BOT√ìN PARA VER MENSAJES DEL FORMULARIO DE CONTACTO -->
<div style="margin-bottom: 20px;">
    <a href="{{ url_for('admin.sugerencias_list') }}"
       style="
         background:#facc15;
         color:#003d80;
         padding:10px 18px;
         border-radius:8px;
         text-decoration:none;
         font-weight:bold;
         display:inline-block;
       ">
        üì© Ver mensajes de contacto
    </a>
</div>

{% endblock %}